<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twin.ai - Chatbot</title>
  <style>
    :root {
      --light-bg: #ffffff;
      --dark-bg: #1e1e1e;
      --light-text: #000000;
      --dark-text: #f5f5f5;
      --light-input-bg: #f0f0f0;
      --dark-input-bg: #2e2e2e;
      --accent: #10a37f;
      --box-light-answer: #d2ffe9;
      --box-light-user: #c4dbfe;
      --box-dark-answer: #145a47;
      --box-dark-user: #2f4f90;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--light-bg);
      color: var(--light-text);
      transition: 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    body.dark {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }

    .header {
      width: 100%;
      height: 60px;
      padding: 10px 20px;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
      background-color: var(--light-bg);
    }

    body.dark .header {
      border-color: #444;
      background-color: var(--dark-bg);
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-title img {
      height: 32px;
      width: auto;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      border-radius: 34px;
      transition: 0.4s;
    }

    .slider:before {
      content: "";
      height: 18px;
      width: 18px;
      position: absolute;
      left: 4px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: 0.4s;
    }

    input:checked + .slider {
      background-color: var(--accent);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: row;
      height: calc(100vh - 60px); /* 60px is header height */
      background-color: var(--light-input-bg);
    }

    body.dark .main {
      background-color: #2e2e2e;
    }

    .sidebar {
      width: 220px;
      padding: 1rem;
      background-color: #f3f3f3;
      border-right: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: background-color 0.3s ease;
    }

    body.dark .sidebar {
      background-color: var(--dark-input-bg);
      border-color: #444;
    }

    .mode-box {
      background: white;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: 0.3s;
      color: inherit;
    }

    body.dark .mode-box {
      background: #333;
      color: var(--dark-text);
    }

    .mode-box.active {
      border-color: var(--accent);
      background: #e6f9f4;
    }

    body.dark .mode-box.active {
      background: var(--box-dark-answer);
      border-color: var(--accent);
    }

    .chat-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    #chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background-color: var(--light-input-bg);
      transition: background-color 0.3s ease;
    }

    body.dark #chat-area {
      background-color: var(--dark-input-bg);
    }

    .box {
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 10px;
      max-width: 80%;
      word-wrap: break-word;
    }

    .box.user {
      background-color: var(--box-light-user);
      align-self: flex-end;
    }

    body.dark .box.user {
      background-color: var(--box-dark-user);
      color: var(--dark-text);
    }

    .box.answer {
      background-color: var(--box-light-answer);
    }

    body.dark .box.answer {
      background-color: var(--box-dark-answer);
      color: var(--dark-text);
    }

    .input-area {
      display: flex;
      padding: 10px;
      margin: 0 1rem 2rem 1rem;
      justify-content: center;
      align-items: center;
      height: 8vh;
      background-color: var(--light-input-bg);
      border-radius: 2rem;
      border: 2px solid #c9c8c8;
    }

    body.dark .input-area {
      background-color: var(--dark-input-bg);
      border: 2px solid #555;
    }

    textarea {
      flex: 1;
      resize: none;
      font-size: 16px;
      padding: 10px;
      background-color: transparent;
      color: inherit;
      border: none;
    }

    textarea:focus {
      outline: none;
    }

    button {
      background-color: var(--accent);
      color: white;
      border: none;
      padding: 10px;
      margin-left: 5px;
      border-radius: 5px;
      cursor: pointer;
    }

    #mic-btn {
      background-color: #ff6b6b;
      border-radius: 50%;
      width: 40px;
      height: 40px;
    }

    #mic-btn.recording {
      background-color: #e74c3c;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-title">
      <img src="https://cdn.prod.website-files.com/65c23bb1aac98e053fb42602/66094895b3bc4e51683de57e_cbb%20circle.png" alt="Logo" />
      <h2 style="margin: 0;">Twin.ai</h2>
    </div>
    <label class="toggle-switch">
      <input type="checkbox" id="theme-toggle" />
      <span class="slider"></span>
    </label>
  </div>

  <div class="main">
    <div class="sidebar" id="sidebar">
  <div class="mode-box active" data-mode="casual">üßã Casual Talk</div>
  <div class="mode-box" data-mode="finance">üí∞ Finance</div>
  <div class="mode-box" data-mode="healthcare">ü©∫ Healthcare</div>
  <div class="mode-box" data-mode="career">üíº Career</div>
  <div class="mode-box" data-mode="supplychain">üì¶ Supply Chain</div>
  <div class="mode-box" data-mode="weather">üå¶Ô∏è Weather</div>
  <div class="mode-box" data-mode="movies">üé¨ Movies</div>
</div>


    <div class="chat-wrapper">
      <div id="chat-area"></div>
      <div class="input-area">
        <textarea id="input" rows="1" placeholder="Say or type something..."></textarea>
        <button id="btn">‚û§</button>
        <button id="mic-btn">üé§</button>
      </div>
    </div>
  </div>

  <script>
    const input = document.getElementById("input");
    const btn = document.getElementById("btn");
    const micBtn = document.getElementById("mic-btn");
    const chatArea = document.getElementById("chat-area");
    const themeToggle = document.getElementById("theme-toggle");
    const modeBoxes = document.querySelectorAll(".mode-box");

    let mode = "casual";
    let messages = [];

    const Humanise = " Speak naturally and conversationally like a human. Use pauses and short paragraphs. Keep the answers short and crisp, as per the user demands nut by default keep it short and crisp, in case of explaining something first just give the brief on furthut query give more details . Avoid robotic or overly formal language also avoid internal dialogues like `thinking`,`laughs` etc.";

    const modePrompts = {
       casual: {
    intro: "üßã Casual Chat activated. Let's talk about anything!",
    prompt: "You are a friendly chatbot for casual, lighthearted conversations. Respond playfully and keep it engaging." + Humanise
  },
  finance: {
    intro: "üí∞ Finance Expert online. Let's talk money!",
    prompt: "You are a knowledgeable finance assistant. Help users understand personal finance, budgeting, investing, and savings." + Humanise
  },
  healthcare: {
    intro: "ü©∫ Healthcare Assistant ready. Your well-being matters!",
    prompt: "You are a health-focused assistant. Provide general wellness advice, healthy habits, and explain medical terms (but never diagnose or prescribe)." + Humanise
  },
  career: {
    intro: "üíº Career Coach online. Let's shape your future!",
    prompt: "You are a career guide. Help users with resume tips, job searching, interview prep, and career path decisions." + Humanise
  },
  supplychain: {
    intro: "üì¶ Supply Chain Expert reporting in!",
    prompt: "You are an assistant specializing in supply chain and inventory management. Explain logistics, warehouse planning, and optimization techniques." + Humanise
  },
  weather: {
    intro: "üå¶Ô∏è Weather Buddy active. Let‚Äôs talk climate!",
    prompt: "You are a climate and weather chatbot. Explain current weather conditions, forecasts, and how climate affects daily life." + Humanise
  },
  movies: {
    intro: "üé¨ Movie Recommender at your service!",
    prompt: "You are a movie-savvy chatbot. Recommend movies based on mood, genre, or popular trends. Share brief summaries and ratings." + Humanise
  }
};

    const showIntro = () => {
      chatArea.innerHTML = "";
      const intro = document.createElement("div");
      intro.className = "box answer";
      intro.textContent = modePrompts[mode].intro;
      chatArea.appendChild(intro);
      messages = [{ role: "system", content: modePrompts[mode].prompt }];
    };

    modeBoxes.forEach(box => {
      box.addEventListener("click", () => {
        modeBoxes.forEach(b => b.classList.remove("active"));
        box.classList.add("active");
        mode = box.dataset.mode;
        showIntro();
      });
    });

    themeToggle.addEventListener("change", () => {
      document.body.classList.toggle("dark");
    });

    window.addEventListener("DOMContentLoaded", showIntro);

    btn.addEventListener("click", async () => {
      const inputText = input.value.trim();
      if (!inputText) return;

      const userBox = document.createElement("div");
      userBox.className = "box user";
      userBox.textContent = inputText;
      chatArea.appendChild(userBox);
      chatArea.scrollTop = chatArea.scrollHeight;

      messages.push({ role: "user", content: inputText });
      input.value = "";

      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ messages })
      });

      const data = await res.json();
      const reply = data.message || "No response.";
      messages.push({ role: "assistant", content: reply });

      const botBox = document.createElement("div");
      botBox.className = "box answer";
      chatArea.appendChild(botBox);
      chatArea.scrollTop = chatArea.scrollHeight;

      const words = reply.split(" ");
      let i = 0;
      const typeEffect = () => {
        if (i < words.length) {
          botBox.textContent += words[i++] + " ";
          chatArea.scrollTop = chatArea.scrollHeight;
          setTimeout(typeEffect, 30);
        }
      };
      typeEffect();

      const tts = await fetch("/speak", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: reply })
      });

      const blob = await tts.blob();
      const url = URL.createObjectURL(blob);
      const audio = new Audio(url);
      audio.play();
    });

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.interimResults = false;

    recognition.onstart = () => micBtn.classList.add("recording");
    recognition.onend = () => micBtn.classList.remove("recording");
    recognition.onerror = e => console.error("Speech error:", e);
    recognition.onresult = (event) => {
      const speech = event.results[0][0].transcript;
      input.value = speech;
      btn.click();
    };

    micBtn.addEventListener("click", () => recognition.start());
  </script>
</body>
</html>
